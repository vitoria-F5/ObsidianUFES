/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var g=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var y=(o,a)=>{for(var e in a)g(o,e,{get:a[e],enumerable:!0})},C=(o,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let r of u(a))!v.call(o,r)&&r!==e&&g(o,r,{get:()=>a[r],enumerable:!(t=m(a,r))||t.enumerable});return o};var k=o=>C(g({},"__esModule",{value:!0}),o);var M={};y(M,{default:()=>l});module.exports=k(M);var s=require("obsidian"),c="moredraw-iframe-view",w="https://moredraw.com";function h(o=21){let a=new Uint8Array(o);return crypto.getRandomValues(a),Array.from(a,e=>("0"+(e%36).toString(36)).slice(-1)).join("")}var l=class extends s.Plugin{constructor(){super(...arguments);this.isIframeOpen=!1}async reloadCurrentIframe(){let e=this.app.workspace.getActiveViewOfType(s.MarkdownView);if(e){let t=`.markdown-${e.getMode()}-view .moredraw-iframe`;e.containerEl.querySelectorAll(t).forEach(i=>{i.contentWindow&&i.contentWindow.postMessage({action:"reload"},"*")})}}async onload(){(0,s.addIcon)("moredraw-icon",`
     <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve" fill="currentColor" ><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path fill="currentColor" stroke="currentColor" d="M32,19.5v-18C32,0.673,31.327,0,30.5,0h-29C0.673,0,0,0.673,0,1.5v18C0,20.327,0.673,21,1.5,21h4.002 L0.549,31.283c-0.12,0.249-0.015,0.547,0.234,0.667C0.853,31.984,0.927,32,1,32c0.186,0,0.365-0.104,0.451-0.283l5-10.382 C6.503,21.226,6.506,21.109,6.479,21h20.038c-0.024,0.096-0.028,0.198,0.01,0.297l4,10.382c0.077,0.199,0.266,0.32,0.467,0.32 c0.06,0,0.121-0.011,0.18-0.033c0.258-0.1,0.386-0.389,0.287-0.646L27.484,21H30.5C31.327,21,32,20.327,32,19.5z M1,19.5v-18 C1,1.224,1.224,1,1.5,1h29C30.776,1,31,1.224,31,1.5v18c0,0.276-0.224,0.5-0.5,0.5h-29C1.224,20,1,19.776,1,19.5z"></path> </g> </g></svg>
    `),this.addRibbonIcon("moredraw-icon","MoreDraw",()=>{this.toggleIframeView()}),this.registerView(c,t=>new f(t)),this.addCommand({id:"insert",name:"Insert White Board",callback:()=>this.insertMoreDraw()}),this.registerMarkdownCodeBlockProcessor("moredraw",(t,r,i)=>{let n=this.parseCustomCodeToHTML(t);r.innerHTML=n}),this.registerEvent(this.app.workspace.on("layout-change",this.reloadCurrentIframe.bind(this))),this.registerEvent(this.app.workspace.on("editor-menu",(t,r,i)=>{t.addItem(n=>{n.setTitle("Add WhiteBoard").setIcon("pencil").onClick(()=>{this.insertMoreDraw()})})}))}onunload(){this.app.workspace.detachLeavesOfType(c)}async activateIframeView(){let{workspace:e}=this.app,t=e.getRightLeaf(!1);t&&(await t.setViewState({type:c}),e.revealLeaf(t))}async toggleIframeView(){let{workspace:e}=this.app,t=this.app.workspace.rightSplit;t.collapsed&&t.expand();let r=e.getLeavesOfType(c).first();if(r)e.revealLeaf(r),this.isIframeOpen=!0;else{let i=e.getRightLeaf(!1);i&&(await i.setViewState({type:c}),e.revealLeaf(i),this.isIframeOpen=!0)}}parseCustomCodeToHTML(e){let t=this.parseParameters(e);return this.createIframeHTML(t)}insertMoreDraw(){var n;let e=(n=this.app.workspace.getActiveViewOfType(s.MarkdownView))==null?void 0:n.editor;if(!e){new s.Notice("\u6CA1\u6709\u6253\u5F00Markdown\u6587\u4EF6");return}let t=e.getCursor(),i=`
\`\`\`moredraw
id:${h()}
title:Untitled
height:400
\`\`\`
`;e.replaceRange(i,t),e.setCursor({line:t.line+6,ch:0})}insertIframe(){var i;let e=(i=this.app.workspace.getActiveViewOfType(s.MarkdownView))==null?void 0:i.editor;if(!e){new s.Notice("\u6CA1\u6709\u6253\u5F00Markdown\u6587\u4EF6");return}let t=e.getCursor(),r=`
			<iframe src="${w}/app/board/new" style="width:100%;height:400px;"></iframe>
			// `;e.replaceRange(r,t),e.setCursor({line:t.line+6,ch:0})}parseParameters(e){let t=/^(\w+)\s*:\s*(.*)$/gm,r,i={};for(;(r=t.exec(e))!==null;){let n=r[1],d=r[2].trim();if(n==="data")try{d=JSON.parse(d)}catch(p){console.error("Error parsing data:",p)}i[n]=d}return i}createIframeHTML(e){let t=e.title||"Default Title",r=e.height||400,i=e.data||"{}";e.id=e.id||h();let n=this.app.workspace.getActiveViewOfType(s.MarkdownView);n&&(n.getMode()==="preview"?e.mode="preview":e.mode="edit");let d=new URLSearchParams(e).toString(),p=`${w}/app/get-started/obsidian?${d}`;return`
      <div class="iframe-container" title="${t}">
        <iframe src="${p}" style="width:100%;height:${r}px"  title="${t}" data-id="${e.id}" class="moredraw-iframe" allow="clipboard-read; clipboard-write"></iframe>
      </div>
    `}},f=class extends s.ItemView{constructor(e){super(e);this.ready=!1;this.iframe=null}getIcon(){return"moredraw-icon"}getViewType(){return c}getDisplayText(){return"MoreDraw"}async onOpen(){let e=this.containerEl.children[1];e.empty();let t=new URLSearchParams({lang:L(),utm_source:"obsidian",obsidian_version:this.getObsidianVersion()}),r=e.createEl("iframe",{attr:{src:w+"/app/get-started/obsidian?"+t.toString(),frameborder:"0",class:"moredraw-iframe",allow:"clipboard-read; clipboard-write"}});this.iframe=r,e.win.onmessage=i=>{i.data&&i.data=="ready"&&(this.ready=!0,this.onReady()),i.data.action==="navigate"&&(r.src=i.data.url)}}onReady(){this.postMessage({type:"init",data:{obsidian:{version:this.getObsidianVersion()}}})}postMessage(e){var t;this.iframe&&this.ready&&((t=this.iframe.contentWindow)==null||t.postMessage(e,"*"))}async onClose(){this.ready=!1}getObsidianVersion(){let t=navigator.userAgent.match(/Obsidian\/([\d.]+)/);return t?t[1]:"unknown"}};function L(){let a=s.moment.locale().split("-");return a[1]&&(a[1]=a[1].toString().toUpperCase()),a.join("-")}

/* nosourcemap */